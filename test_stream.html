<!DOCTYPE html>
<html>
<head>
    <title>Stream Processor Test</title>
</head>
<body>
    <div id="output"></div>
    <button onclick="testStream()">Test Stream</button>
    
    <script src="/static/js/stream_processor.js"></script>
    <script>
        function testStream() {
            const output = document.getElementById('output');
            const processor = new StreamProcessor();
            
            processor.setCallbacks(
                (fullContent) => {
                    output.textContent = fullContent;
                    console.log('Character callback:', fullContent);
                },
                (fullContent) => {
                    console.log('Pause callback:', fullContent);
                },
                (fullContent) => {
                    console.log('Complete callback:', fullContent);
                }
            );
            
            // 模拟数据流
            const testData = "这是一个测试。看看是否会快闪？希望不会！";
            
            // 分批添加数据
            let i = 0;
            const interval = setInterval(() => {
                if (i < testData.length) {
                    processor.addData(testData[i]);
                    i++;
                } else {
                    processor.markEnd();
                    clearInterval(interval);
                }
            }, 10); // 每10ms添加一个字符
        }
    </script>
</body>
</html>